---
layout:     post
title:      Making An Ambient Lighting System With A Zynq
date:       2019-07-06 09:00:00
summary:    My final year university project
categories: technology
---

![The Final System](/images/project/final_system.jpg)

An Ambient (or bias) lighting system is essentially a set of lights that are placed around the back of a
computer monitor or television, so that the lights are facing away from the viewer. The idea is that the
lights illuminate the area behind and around the display with colours according to the image that is being
displayed. This (apparently) leads to reduced eye strain and increased viewer immersion. If you want to see
one in the wild, [Philips Ambilight TVs](https://www.philips.co.uk/c-m-so/tv/p/ambilight) are a great example.

My final year University project was to build one of these using a [Digilent Zybo
Z7-10](https://store.digilentinc.com/zybo-z7-zynq-7000-arm-fpga-soc-development-board/).
This is a cool development board based on a Xilinx Zynq, which is a System on
Chip that contains an ARM CPU as well an FPGA. The FPGA and CPU can communicate
to each other over a bus, and allows for hardware-software co-processing.

### Physical Setup
![LED strip attached to back of monitor](/images/project/strip.jpg)

As the Zybo contains both a HDMI input and a HDMI output port, the system is designed so that the board can
intercept the HDMI connection between a monitor and a video source in order to perform image processing. The
board is also connected to a strip of WS2812B addressable RGB LEDs via its PMOD GPIO pins. The LED strip was
simply attached to the monitor with Blu Tack. From the image above, you can see that I had to cut the LED
strip into 4 smaller strips, and then connected all of the strips together. This was just to allow the strip
to bend around the corners of the monitor.

### Implementation
The entire system uses the [Digilent Zybo Z7 HDMI
Demo](https://reference.digilentinc.com/learn/programmable-logic/tutorials/zybo-z7-hdmi-demo/start) as a base
to begin working from. This took care of all of the intricacies of setting up HDMI input and output, and for
the rest of the project, and allowed to me to get working on the core of the project relatively quickly.

Further to that, I also used Marshall Wingerson's [DigiLED](https://github.com/mwingerson/DigiLED) WS2812
driver core for controlling the LEDs (although I had to alter the driver file so that it could support the RGB
colour model).

The system operates by processing 8 pre-defined *sections* of a frame (pictured below). This is mainly to
increase the execution speed, as less pixels are analysed, but it also allows for different LEDs to have
different colours depending on the image. For example, in a sunrise/sunset scene, this would allow the LEDs
that are nearest to the Sun to glow yellow or orange.

![The 8 sections](/images/project/sections.png)

The basic functional behaviour can described with the following diagram:
![Basic Functionality Architecture Diagram](/images/project/Simple Architecture.png)
We will go over every block in the diagram (apart from the DigiLED core) and explain what they do.

#### Section Maker
Rather than processing an entire frame, the system 


![System Architecture Diagram](/images/project/DesignFinal.jpg)
### Hardware Acceleration

### Results

### Limitations
